<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>Christmas Tree with Audio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
    font-family: Arial, sans-serif;
}

#canvas {
    display: block;
}

.controls {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 12px;
}

.btn {
    padding: 10px 16px;
    background: rgba(255,255,255,0.1);
    color: white;
    border-radius: 20px;
    cursor: pointer;
    user-select: none;
    font-size: 14px;
    backdrop-filter: blur(6px);
}

.btn:hover {
    background: rgba(255,255,255,0.25);
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div class="controls">
    <div class="btn" id="startBtn">â–¶ Start</div>
    <div class="btn" id="scatterBtn">ðŸ’¥ Scatter</div>
    <div class="btn" id="muteBtn">ðŸ”Š Sound</div>
</div>

<script>
/* =====================
   CANVAS SETUP
===================== */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* =====================
   AUDIO CONFIG
===================== */
const AUDIO_CONFIG = {
    bgm: "./audio/christmas.mp3",
    scatter: "./audio/scatter.mp3",
    focus: "./audio/focus.mp3",
    volume: {
        bgm: 0.35,
        sfx: 0.6
    }
};

let bgmAudio, sfxScatter, sfxFocus;
let audioEnabled = false;

/* =====================
   INIT AUDIO (user gesture)
===================== */
function initAudio() {
    if (audioEnabled) return;

    bgmAudio = new Audio(AUDIO_CONFIG.bgm);
    bgmAudio.loop = true;
    bgmAudio.volume = AUDIO_CONFIG.volume.bgm;

    sfxScatter = new Audio(AUDIO_CONFIG.scatter);
    sfxScatter.volume = AUDIO_CONFIG.volume.sfx;

    sfxFocus = new Audio(AUDIO_CONFIG.focus);
    sfxFocus.volume = AUDIO_CONFIG.volume.sfx;

    bgmAudio.play().catch(()=>{});
    audioEnabled = true;
}

/* =====================
   PARTICLES
===================== */
const particles = [];
const TREE_HEIGHT = 220;
const PARTICLE_COUNT = 800;
let scatterMode = false;

function createTree() {
    particles.length = 0;
    for (let i = 0; i < PARTICLE_COUNT; i++) {
        const t = Math.random();
        const radius = (1 - t) * 120;
        const angle = Math.random() * Math.PI * 2;
        particles.push({
            x: canvas.width / 2 + Math.cos(angle) * radius,
            y: canvas.height / 2 + t * TREE_HEIGHT - TREE_HEIGHT / 2,
            ox: 0,
            oy: 0,
            vx: 0,
            vy: 0,
            r: Math.random() * 2 + 1,
            color: `hsl(${Math.random()*120+90},100%,70%)`
        });
    }
}
createTree();

/* =====================
   UPDATE + DRAW
===================== */
function update() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    for (const p of particles) {
        if (scatterMode) {
            p.vx += (Math.random() - 0.5) * 0.4;
            p.vy += (Math.random() - 0.5) * 0.4;
        } else {
            p.vx *= 0.9;
            p.vy *= 0.9;
        }

        p.x += p.vx;
        p.y += p.vy;

        ctx.beginPath();
        ctx.fillStyle = p.color;
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fill();
    }

    requestAnimationFrame(update);
}
update();

/* =====================
   BUTTON EVENTS
===================== */
document.getElementById("startBtn").onclick = () => {
    initAudio();
};

document.getElementById("scatterBtn").onclick = () => {
    initAudio();
    scatterMode = !scatterMode;

    if (audioEnabled) {
        sfxScatter.currentTime = 0;
        sfxScatter.play();
    }
};

document.getElementById("muteBtn").onclick = () => {
    if (!bgmAudio) return;
    bgmAudio.muted = !bgmAudio.muted;
    document.getElementById("muteBtn").innerText =
        bgmAudio.muted ? "ðŸ”‡ Muted" : "ðŸ”Š Sound";
};
</script>

</body>
</html>
